/*
 * Copyright (c) 2023 Nordic Semiconductor ASA
 *
 * SPDX-License-Identifier: Apache-2.0
 */

#ifndef ZEPHYR_DFU_BOOT_MCUBOOT_PARTITIONS_H_
#define ZEPHYR_DFU_BOOT_MCUBOOT_PARTITIONS_H_

#include <zephyr/storage/flash_map.h>

#if (defined(CONFIG_UPDATEABLE_IMAGE_NUMBER) && CONFIG_UPDATEABLE_IMAGE_NUMBER > 1)
#define ZEPHYR_MCUBOOT_APP_IMAGE_COUNT CONFIG_UPDATEABLE_IMAGE_NUMBER
#else
#define ZEPHYR_MCUBOOT_APP_IMAGE_COUNT 1
#endif

#ifdef CONFIG_TRUSTED_EXECUTION_NONSECURE
#define ZEPHYR_MCUBOOT_APP_0_PRIMARY_SLOT_LABEL		slot0_ns_partition
#define ZEPHYR_MCUBOOT_APP_0_SECONDARY_SLOT_LABEL	slot1_ns_partition
#else
#define ZEPHYR_MCUBOOT_APP_0_PRIMARY_SLOT_LABEL		slot0_partition
#define ZEPHYR_MCUBOOT_APP_0_SECONDARY_SLOT_LABEL	slot1_partition
#endif /* CONFIG_TRUSTED_EXECUTION_NONSECURE */

#define ZEPHYR_MCUBOOT_APP_1_PRIMARY_SLOT_LABEL		slot2_partition
#define ZEPHYR_MCUBOOT_APP_1_SECONDARY_SLOT_LABEL	slot3_partition

#define ZEPHYR_MCUBOOT_APP_0_PRIMARY_SLOT_EXISTS \
	FIXED_PARTITION_EXISTS(ZEPHYR_MCUBOOT_APP_0_PRIMARY_SLOT_LABEL)
#define ZEPHYR_MCUBOOT_APP_0_SECONDARY_SLOT_EXISTS \
	FIXED_PARTITION_EXISTS(ZEPHYR_MCUBOOT_APP_0_SECONDARY_SLOT_LABEL)
#define ZEPHYR_MCUBOOT_APP_1_PRIMARY_SLOT_EXISTS \
	FIXED_PARTITION_EXISTS(ZEPHYR_MCUBOOT_APP_1_PRIMARY_SLOT_LABEL)
#define ZEPHYR_MCUBOOT_APP_1_SECONDARY_SLOT_EXISTS \
	FIXED_PARTITION_EXISTS(ZEPHYR_MCUBOOT_APP_1_SECONDARY_SLOT_LABEL)

/* Application 0 image slots */
#define ZEPHYR_MCUBOOT_APP_0_PRIMARY_SLOT_ID				\
	FIXED_PARTITION_ID(ZEPHYR_MCUBOOT_APP_0_PRIMARY_SLOT_LABEL)
/* It is possible that application is build for MCUboot with single application slot
 * configuration, in which case the secondary slot may not exist.
 */
#if ZEPHYR_MCUBOOT_APP_0_SECONDARY_SLOT_EXISTS
#define ZEPHYR_MCUBOOT_APP_0_SECONDARY_SLOT_ID				\
	FIXED_PARTITION_ID(ZEPHYR_MCUBOOT_APP_0_SECONDARY_SLOT_LABEL)
#endif

/* Application 1 image slots */
#if ZEPHYR_MCUBOOT_APP_IMAGE_COUNT == 2
#define ZEPHYR_MCUBOOT_APP_1_PRIMARY_SLOT_ID				\
	FIXED_PARTITION_ID(ZEPHYR_MCUBOOT_APP_1_PRIMARY_SLOT_LABEL)
#define ZEPHYR_MCUBOOT_APP_1_SECONDARY_SLOT_ID				\
	FIXED_PARTITION_ID(ZEPHYR_MCUBOOT_APP_1_SECONDARY_SLOT_LABEL)
#elif ZEPHYR_MCUBOOT_APP_IMAGE_COUNT == 0 || ZEPHYR_MCUBOOT_APP_IMAGE_COUNT > 2
#error Unsupported number of application images.
#endif

#if FIXED_PARTITION_EXISTS(scratch_partition)
#define ZEPHYR_MCUBOOT_SCRATCH_ID FIXED_PARTITION_ID(scratch_partition)
#endif

#endif /* ZEPHYR_DFU_BOOT_MCUBOOT_PARTITIONS_H_ */

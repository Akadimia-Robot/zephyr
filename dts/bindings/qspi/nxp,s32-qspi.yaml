# Copyright 2023-2024 NXP
# SPDX-License-Identifier: Apache-2.0

description: |
  NXP S32 Quad Serial Peripheral Interface (QSPI) Controller.

  QSPI acts as an interface to up to two serial flash memory devices, each with
  up to eight bidirectional data lines, depending on the platform.

compatible: "nxp,s32-qspi"

include: [base.yaml, pinctrl-device.yaml]

bus: qspi

properties:
  reg:
    required: true

  reg-names:
    required: true

  "#address-cells":
    const: 1

  "#size-cells":
    const: 0

  data-rate:
    required: true
    type: string
    enum:
      - SDR
      - DDR
    description: |
      Selects the read mode:
      - Single Data Rate (SDR): sampling of incoming data occurs on single edges.
      - Double Data Rate (DDR): sampling of incoming data occurs on both edges.

  hold-time-2x:
    type: boolean
    description: |
      Set to align incoming data with 2x serial flash half clock, when in DDR
      mode. Otherwise, data will be aligned to the posedge of the controller's
      internal reference clock.

  sample-delay-half-cycle:
    type: boolean
    description: |
      Set to use half-cycle early DQS delay when sampling received data.

  sample-phase-inverted:
    type: boolean
    description: |
      Set to sample received data at inverted clock.

  cs-setup-time:
    type: int
    enum: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]
    default: 3
    description: |
      Chip select setup time, in serial clock cycles. A bigger value will pull
      the CS signal earlier before the transaction starts.
      The default corresponds to the reset value of the register field.

  cs-hold-time:
    type: int
    enum: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]
    default: 3
    description: |
      Chip select hold time, in serial clock cycles. A bigger value will release
      the CS signal later after the transaction ends.
      The default corresponds to the reset value of the register field.

  column-space:
    type: int
    default: 0
    enum: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]
    description: |
      Column Address Space bit width. For example, if the column address is
      [2:0] of QSPI_SFAR/AHB address, then the column address space bit width
      must be 3. If there is no column address separation in any serial flash
      device connected to this controller, this value must be programmed to 0.
      The default corresponds to the reset value of the register field.

  word-addressable:
    type: boolean
    description: |
      Set if the serial flash device connected to this controller is word
      (2 bytes) addressable.

  byte-swapping:
    type: boolean
    description: |
      In case of Octal DDR mode, specifies whether a word unit composed of two
      bytes from posedge and negedge of a single DQS cycle needs to be swapped.

  ahb-buffers:
    type: array
    required: true
    description: |
      AHB receive buffer configuration as in an array of tuples in the form
      <master-id buffer-size>. The master ID of every incoming request is
      checked and the data is returned or fetched into the corresponding
      associated buffer.
      The maximum buffer size and maximum number of buffers is SoC specific.

  ahb-buffers-all-masters:
    type: boolean
    description: |
      Any access from a master not associated with any other buffer is routed to
      the last buffer.

  lut-size:
    type: int
    required: true
    description: |
      Number of look-up table registers.

  tx-fifo-size:
    type: int
    required: true
    description: |
      Transmit FIFO size in bytes.

  rx-fifo-size:
    type: int
    required: true
    description: |
      Receive FIFO size in bytes.

  chip-options:
    type: int
    description: |
      Value to write to QSPI SOC configuration register (SOCCFG), if available.
      For details, see chip-specific QSPI information in the device reference
      manual.

  has-ddr:
    type: boolean
    description: |
      Set if the device supports Double Data Rate (DDR) mode.

  has-dqs-clock:
    type: boolean
    description: |
      Set if the device supports internal DQS clock.

  has-dll:
    type: boolean
    description: |
      Set if the device supports DLL.

  has-dllcr-en:
    type: boolean
    description: |
      Set if the device supports DLL enable (bitfield DLLCR[DLLEN]).

  has-dllcr-loop-control:
    type: boolean
    description: |
      Set if the device supports DLL loop control configuration (bitfields
      DLLCR[DLL_REFCNTR] and DLLCR[DLLRES]).

  has-dllcr-slave-auto-updt:
    type: boolean
    description: |
      Set if the device supports DLL slave chain auto-update
      (bitfield DLLCR[SLAVE_AUTO_UPDT]).

  has-sfacr-cas:
    type: boolean
    description: |
      Set if the device supports column address space (bitfield SFACR[CAS]).

  has-sfacr-byte-swap:
    type: boolean
    description: |
      Set if the device supports byte swapping (bitfield SFACR[BYTE_SWAP]).

  has-rbct-rxbrd:
    type: boolean
    description: |
      Set if the device supports receive buffer readout (bitfield RBCT[RXBRD]).

  has-sptrclr-abrt-clr:
    type: boolean
    description: |
      Set if the device supports flash memory abort/AHB buffer clear
      (bifield SPTRCLR[ABRT_CLR]).

  has-mcr-isd:
    type: boolean
    description: |
      Set if the device supports configuration if idle lines (bitfield MCR[ISDx]).

child-binding:
  description: NXP S32 QuadSPI memory device

  include: nxp,s32-qspi-device.yaml

common:
  tags: posix
  min_ram: 64
  # Currently, POSIX subsystem and "posix" pseudo-arch don't work well
  # together. This is supposed to be addressed later.
  # riscv toolchain lacks sys/timespec.h (maybe something else), so not
  # good for POSIX.
  arch_exclude: posix riscv32
  # qemu_x86_64 currently uses Linux host toolchains, which leaks host
  # headers into the build.
  platform_exclude: qemu_x86_64

tests:
  portability.posix:
    platform_exclude: nsim_sem_mpu_stack_guard nsim_em_mpu_stack_guard
    extra_configs:
      - CONFIG_NEWLIB_LIBC=n
  portability.posix.newlib:
    platform_exclude: nsim_sem_mpu_stack_guard nsim_em_mpu_stack_guard
    filter: TOOLCHAIN_HAS_NEWLIB == 1
    extra_configs:
      - CONFIG_NEWLIB_LIBC=y
  portability.posix.nsim:
    platform_whitelist: nsim_sem_mpu_stack_guard nsim_em_mpu_stack_guard
    extra_configs:
      - CONFIG_NEWLIB_LIBC=n
      - CONFIG_TEST_USERSPACE=n
      - CONFIG_TEST_HW_STACK_PROTECTION=n
  portability.posix.newlib.nsim:
    platform_whitelist: nsim_sem_mpu_stack_guard nsim_em_mpu_stack_guard
    filter: TOOLCHAIN_HAS_NEWLIB == 1
    extra_configs:
      - CONFIG_NEWLIB_LIBC=y
      - CONFIG_TEST_USERSPACE=n
      - CONFIG_TEST_HW_STACK_PROTECTION=n

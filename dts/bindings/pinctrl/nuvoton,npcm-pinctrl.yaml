# Copyright (c) 2024 Nuvoton Technology Corporation.
# SPDX-License-Identifier: Apache-2.0

description: |
  The Nuvoton pin controller is a singleton node responsible for controlling
  pin function selection and pin properties. For example, you can use these
  nodes to select peripheral pin functions.

  Here is a list of supported standard pin properties:
    - bias-pull-down: Enable pull-down resistor.
    - bias-pull-up: Enable pull-up resistor.

  An example for the NPCM4 family, include the chip-level pinctrl DTSI file in the
  board-level DTS:

    #include <nuvoton/npcm/npcm4/npcm4-pincfg-default.dtsi>

  We want to use the I2C0_0 port of the NPCM400F controller and enable the
  internal 3.3V pull-up if its I2C frequency won't exceed 400kHz.

  To change a pin's pinctrl default properties, add a reference to the pin in
  the board's DTS file and set the properties in the child node of pinctrl as below:

    i2c1a_scl_sda_gpio60_61: periph-i2c1a {
      scl {
        pinmux = <GPIO60__RSTOUT2__SCL1A 2>;  /* Set the pinmux to SCL1A */
        lvol = <0>;                           /* Set the voltage level to 3.3V */
        bias-pull-up;                         /* Enable internal pull-up for i2c0_0 */
      };
      sda {
        pinmux = <GPIO61__RSTOUT1__SDA1A 2>;  /* Set the pinmux to SDA1A */
        lvol = <0>;                           /* Set the voltage level to 3.3V */
      };
    };

    &i2c0_0 {
      pinctrl-0 = <&i2c1a_scl_sda_gpio60_61>;
      pinctrl-names = "default";
    };

compatible: "nuvoton,npcm-pinctrl"

include: base.yaml

properties:
  reg:
    required: true

child-binding:
  description: |
    The NPCM pin controller pinmux configuration node is responsible for setting up pin alternate
    functions with configurations of registers. This includes defining the alternate pin registers
    and their bits, as well as the alternate pin selection configurations. The voltage output level
    is also included.

  properties:
    pinmux-group-def:
      type: boolean
      description: Indicates that this node is a pinmux group definition.
    pin-reg:
      type: array
      description: |
        The pinmux group definition property.
        The alternate pin registers and their bits. There are a total of 5 registers.
        The register order is from 4 to 0 for convenience in setting the alternate function config
        value, and the maximum bits to configure are 5 (the alternate function config value is 0x1F
        when all register bits are set).
        Set NPCM_PIN_REG_NULL for an empty register.
    alt:
      type: array
      description: |
        The pinmux group definition property.
        The alternate pin selection configurations consist of a total of 6 groups.
        The group order is from 0 to 5, and the bit N value in each group is for
        register N's bit value.
        Set NPCM_PIN_CFG_NULL for an empty configuration.
    id:
      type: array
      description: |
        The pinmux group definition property.
        The pin's index. The name of this property follows the group's order.
    lv-reg:
      type: array
      description: |
        The low-voltage level definition property.
        The low-voltage level register and its bit.
    lv-def:
      type: array
      description: |
        The low-voltage level definition property.
        The default voltage level in hardware of supported alt functions. Set with either
        NPCM_IO_VOLT_LV_1V8 or NPCM_IO_VOLT_LV_3V3.
    lv-sup:
      type: array
      description: |
        The low-voltage level definition property.
        The flag of low-voltage level support. The bit N value represents that group N supports
        low-voltage level.
    pupd-config-extend:
      type: boolean
      description: |
        The peripheral pull-up/down definition property.
        Indicates that there are two groups of peripheral pull-up/down configurations. The default
        group number is 1.
    pupd-reg:
      type: array
      description: |
        The peripheral pull-up/down definition property.
        The peripheral pull-up/down register and its bit. There are a total of 2 registers if
        property pupd-config-extend is set.
    pupd-type:
      type: array
      description: |
        The peripheral pull-up/down definition property.
        The default peripheral pull-up/down in hardware of supported alt functions. It should be
        set with NPCM_BIAS_TYPE_PULL_UP, NPCM_BIAS_TYPE_PULL_DOWN. There are a total of 2
        configurations if property pupd-config-extend is set.
    pupd-sup:
      type: array
      description: |
        The peripheral pull-up/down definition property.
        The flag of peripheral pull-up/down support. The bit N value represents that group N
        supports peripheral pull-up/down level. The maximum number of supported groups is 2.

  child-binding:
    description: |
      The NPCM pin controller pin configuration group node is responsible for setting pin
      configurations including bias-pull-up, bias-pull-down, pinmux alternate function selection,
      voltage level, and device control.

    include:
      - name: pincfg-node.yaml
        property-allowlist:
          - bias-pull-down
          - bias-pull-up

    properties:
      pinmux:
        type: array
        required: true
        description: |
          The pin configuration group property.
          The alternate pin group index and selection of alternate function.
      dev-ctl:
        type: array
        description: |
          The pin configuration group property.
          Configurations of the device control such as tri-state, IO type, and so on.
      lvol:
        type: array
        description: |
          The pin configuration group property.
          Configurations of the low-voltage controller. Set 1 for low-voltage level, 0 for normal
          voltage level. Be aware that not every IO supports output at low-voltage level. If set to
          unsupported pins, this property will be ignored.
